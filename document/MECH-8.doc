<!DOCTYPE html>
<html>
<head>
    <title>[#MECH-8] [Function] Gaea CAN message校验需求</title>
    <meta http-equiv="Content-Type" Content="application/vnd.ms-word; charset=UTF-8">
        <style type="text/css">

.tableBorder, .grid
{
    background-color: #fff;
    width: 100%;
    border-collapse: collapse;
}

.tableBorder td, .grid td
{
    vertical-align: top;
    padding: 2px;
    border: 1px solid #ccc;
}

.noPadding
{
    padding: 0 !important;
}

h3 .subText
{
    font-size: 60%;
    font-weight: normal;
}

.tabLabel
{
    font-weight: bold;
    border: 1px solid #ccc;
    border-bottom:none;
    padding: 2px;
    display: inline;
}

td.blank
{
    padding: 0;
    margin: 0;
}

.blank td
{
    border: none;
}

#descriptionArea
{
    margin: 0;
    padding: 2px;
    border: 1px solid #ccc;
}

hr
{
    border-top:1px solid #aaa;
}

hr.fullcontent
{
  height: 15px;
  padding: 10px 0;
  background: #fff url('https://jiraarvr.flex.com/images/icons/hr.gif') no-repeat scroll center;
}

</style>

</head>
<body>

<table class="tableBorder" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td bgcolor="#f0f0f0" width="100%" colspan="2" valign="top">
                            <h3 class="formtitle">
                        [MECH-8]&nbsp;<a href="https://jiraarvr.flex.com/browse/MECH-8">[Function] Gaea CAN message校验需求</a>
            <span class="subText">
               Created: 27/May/20                   &nbsp;Updated: 13/Jul/20

                                    &nbsp;Due: 29/May/20
                                                    &nbsp;Resolved: 13/Jul/20
                            </span>
            </h3>
        </td>
    </tr>
    <tr>
        <td width="20%"><b>Status:</b></td>
        <td width="80%">Done</td>
    </tr>
    <tr>
        <td width="20%"><b>Project:</b></td>
        <td width="80%"><a href="https://jiraarvr.flex.com/secure/BrowseProject.jspa?id=10802">Mech</a></td>
    </tr>

        <tr>
            <td><b>Component/s:</b></td>
            <td>
                                        <a title="Third Party"
                href="https://jiraarvr.flex.com/issues/?jql=project%3D10802%20AND%20%22component%22%3D10920%20ORDER%20BY%20priority%20ASC"
            >Third Party</a>                        </td>
    </tr>
    

        <tr>
            <td><b>Affects Version/s:</b></td>
            <td>
                                        <a title="Gaea"
                href="https://jiraarvr.flex.com/issues/?jql=project%3D10802%20AND%20%22affectedVersion%22%3D10907%20ORDER%20BY%20priority%20ASC"
            >Gaea</a>                        </td>
    </tr>
    

        <tr>
            <td><b>Fix Version/s:</b></td>
            <td>
                            None
                </td>
    </tr>
    
            <tr>
            <td><b>Security Level:</b></td>
            <td>
                Flex Only
                                    <font size=1> (Issue for Flex only)</font>
                            </td>
       </tr>
    </table>

<br />
<table class="grid" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td bgcolor="#f0f0f0" valign="top" width="20%">
            <b>Type:</b>
        </td>
        <td bgcolor="#ffffff" valign="top"  width="30%" >
            New Feature
        </td>

                    <td bgcolor="#f0f0f0">
                <b>Priority:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" nowrap>
                Critical
            </td>
            </tr>
    <tr>
                        <td bgcolor="#f0f0f0" valign="top" width="20%">
                <b>Reporter:</b>
            </td>
            <td bgcolor="#ffffff" valign="top"  width="30%" >
                                            <a class="user-hover" rel="shdmzhao" id="word_reporter_shdmzhao" href="https://jiraarvr.flex.com/secure/ViewProfile.jspa?name=shdmzhao">Mos Zhao (Terminated) [X] (Inactive)</a>
                            </td>
        
                    <td bgcolor="#f0f0f0" width="20%">
                <b>Assignee:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" nowrap  width="30%" >
                                            <a class="user-hover" rel="shdmzhao" id="word_assignee_shdmzhao" href="https://jiraarvr.flex.com/secure/ViewProfile.jspa?name=shdmzhao">Mos Zhao (Terminated) [X] (Inactive)</a>
                            </td>
            </tr>
    	<tr>
		<td bgcolor="#f0f0f0" width="20%">
			<b>Resolution:</b>
		</td>
		<td bgcolor="#ffffff" valign="top" width="30%" nowrap>
                            Done
                    </td>
                    <td bgcolor="#f0f0f0" width="20%">
                <b>Votes:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" width="30%" nowrap>
                0
            </td>
        
    </tr>
    
        <tr>
        <td bgcolor="#f0f0f0" width="20%">
            <b>Labels:</b>
        </td>
        <td id="labels-12429-value" class="value" bgcolor="#ffffff" valign="top" colspan="3" nowrap>
                            can                    </td>
    </tr>
    
    	<tr>
        		<td bgcolor="#f0f0f0" width="20%"><b>Remaining Estimate:</b></td>
        <td bgcolor="#ffffff" valign="top" nowrap width="80%" colspan="3">
                            Not Specified
            		</td>
    </tr>
    <tr>
                <td bgcolor="#f0f0f0" width="20%"><b>Time Spent:</b></td>
		<td bgcolor="#ffffff" valign="top" nowrap width="80%" colspan="3">
                            Not Specified
            		</td>
	</tr>
    <tr>
                <td bgcolor="#f0f0f0" width="20%"><b>Original Estimate:</b></td>
		<td bgcolor="#ffffff" valign="top" nowrap width="80%" colspan="3">
                            Not Specified
            		</td>
    </tr>
    
    </table>



    <br />

    	<table class="grid" cellpadding="0" cellspacing="0" border="0" width="100%">
            

        
    



                        <tr>
                <td bgcolor="#f0f0f0" width="20%" valign="top"><b>Source:</b></td>
                <td id="customfield_10500-12429-value" class="value" bgcolor="#ffffff" width="80%">    Function Test
</td>
            </tr>
            </table>

    <br/>

    <table cellpadding="2" cellspacing="0" border="0" width="100%" align="center">
    <tr>
        <td bgcolor="#bbbbbb" width="1%" nowrap align="center">
            &nbsp;<font color="#ffffff"><b>Description</b></font>&nbsp;
        </td>
        <td>&nbsp;</td>
    </tr>
    </table>

    <table cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td id="descriptionArea">
            <ol>
	<li>7路CAN，CAN1~CAN7;</li>
	<li>上位机CAN报文发送ID为(0x160, 0x1A0, 0x1E0, 0xB0, 0x2A5, 0x74, 0x8D);</li>
	<li>上位机接收CAN ID为(0x161, 0x1A1, 0x1E1, 0xB1, 0x2A6, 0x75, 0x8E);</li>
	<li>CAN报文的周期时间为(10, 20, 20, 50, 50, 100, 100)ms;</li>
	<li>CAN报文的时间误差规定: 小于等于20ms时，误差允许范围±20%，大于20ms时，误差允许范围±10%;</li>
	<li>CAN报文的长度为(64, 64, 64, 64, 8, 8, 64)bytes;</li>
	<li>CAN报文倒数第二个字节为报文序列号，从0开始计，下一帧报文加1，直到0xFF，然后再为0，一直循环;</li>
	<li>CAN报文倒数第一个字节为前面所有报文数据的CRC8检验值，包含序列号(CRC8的C代码如下);</li>
	<li>CAN异常事件上报</li>
</ol>


<p> </p>
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>status</th>
<th class='confluenceTh'>Heading 2</th>
</tr>
<tr>
<td class='confluenceTd'>0x01</td>
<td class='confluenceTd'>报文间隔时间异常</td>
</tr>
<tr>
<td class='confluenceTd'>0x02</td>
<td class='confluenceTd'>报文ID错误</td>
</tr>
<tr>
<td class='confluenceTd'>0x03</td>
<td class='confluenceTd'>报文长度错误</td>
</tr>
<tr>
<td class='confluenceTd'>0x04</td>
<td class='confluenceTd'>报文序号错误</td>
</tr>
<tr>
<td class='confluenceTd'>0x05</td>
<td class='confluenceTd'>报文数据错误</td>
</tr>
<tr>
<td class='confluenceTd'>0x06</td>
<td class='confluenceTd'>SAFETY CAN ERR</td>
</tr>
<tr>
<td class='confluenceTd'>0x07</td>
<td class='confluenceTd'>CAN BUS ERR</td>
</tr>
</tbody></table>
</div>


<p> </p>

<p> </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-comment">/* CRC8 table */</span>

<span class="code-keyword">static</span> <span class="code-keyword">const</span> uint8 crc8_table[256] =

{

            0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15, 0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,

            0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65, 0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,

            0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5, 0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,

            0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85, 0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,

            0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2, 0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,

            0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2, 0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,

            0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32, 0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,

            0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42, 0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,

            0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c, 0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,

            0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec, 0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,

            0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c, 0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,

            0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c, 0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,

            0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b, 0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,

            0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b, 0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,

            0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb, 0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,

            0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb, 0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3

};

 

/*

* \brief  get CRC8 check function

*

* \para  data: the point of data which need to CRC8 check

*        len: length of data which need to CRC8 check

*

* \<span class="code-keyword">return</span> CRC8 check result

*/

<span class="code-keyword">static</span> uint8 get_crc8_checksum(uint8* data, uint16 len)

{

            uint16 i = 0;

            uint8 res = 0x0;

 

            <span class="code-comment">// data CRC8 check
</span>
            <span class="code-keyword">for</span> (i = 0; i &lt; len; i++) {

                        res = crc8_table[(uint8)res ^ *data];

                        data++;

            }

 

            <span class="code-keyword">return</span> res;

}
</pre>
</div></div>
<p> </p>
            <br/>
        </td>
    </tr>
    </table>

    <br/>

    <table cellpadding="2" cellspacing="0" border="0" width="100%" align="center">
    <tr>
        <td bgcolor="#bbbbbb" width="1%" nowrap align="center">
            &nbsp;<font color="#ffffff"><b>Comments</b></font>&nbsp;
        </td>
        <td>&nbsp;</td>
    </tr>
    </table>

    <table cellpadding="0" cellspacing="0" border="0" width="100%" class="grid" style="margin: 0;">
                <tr id="comment-header-14660"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="shdmzhao" id="word_commented_shdmzhao" href="https://jiraarvr.flex.com/secure/ViewProfile.jspa?name=shdmzhao">Mos Zhao (Terminated) [X] (Inactive)</a>
                                        <font size="-2">
            [
                <font color="#336699">27/May/20</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-14660"><td bgcolor="#ffffff">
            <p><a href="https://jiraarvr.flex.com/secure/ViewProfile.jspa?name=shdashen" class="user-hover" rel="shdashen">Allen Shen</a>, 需要提供以下说明内容：</p>
<ol>
	<li>上位机发送的CAN MSG ID和设备的SN和CHN的对应关系</li>
	<li>上位机发送的CAN MSG的数据域有什么要求？</li>
	<li>上位机接收的CAN MSG ID和设备的SN和CHN的对应关系(这里1和2我也可以随便配置，但是以后使用还是要根据实际情况进行配置的)</li>
	<li>CAN异常事件上报我怎么使用？</li>
</ol>

        </td></tr>
                <tr id="comment-header-14661"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="shdashen" id="word_commented_shdashen" href="https://jiraarvr.flex.com/secure/ViewProfile.jspa?name=shdashen">Allen Shen</a>
                                        <font size="-2">
            [
                <font color="#336699">27/May/20</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-14661"><td bgcolor="#ffffff">
            <ol>
	<li>CHN与CAN的对应关系：CHN1对应 CAN1，CAN7， CHN2 对应CAN2~CAN6，描述中MSG ID为CAN1~CAN7顺序排列的。</li>
	<li>CAN MSG的数据域除了最后两个字节外无其他要求，16进制数据即可</li>
	<li>同1</li>
	<li>收到异常事件，显示’CANn出现xx异常’</li>
</ol>

        </td></tr>
                <tr id="comment-header-14662"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="shdashen" id="word_commented_shdashen" href="https://jiraarvr.flex.com/secure/ViewProfile.jspa?name=shdashen">Allen Shen</a>
                                        <font size="-2">
            [
                <font color="#336699">28/May/20</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-14662"><td bgcolor="#ffffff">
            <p>去掉报文序列号的需求，保留最后一个字节的CRC8校验。</p>
        </td></tr>
                <tr id="comment-header-14663"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="shdmzhao" id="word_commented_shdmzhao" href="https://jiraarvr.flex.com/secure/ViewProfile.jspa?name=shdmzhao">Mos Zhao (Terminated) [X] (Inactive)</a>
                                        <font size="-2">
            [
                <font color="#336699">29/May/20</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-14663"><td bgcolor="#ffffff">
            <div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>CAN channel</th>
<th class='confluenceTh'>Send(From PC)</th>
<th class='confluenceTh'>Receive(From PC)</th>
<th class='confluenceTh'>Period(ms)</th>
<th class='confluenceTh'>Length(Bytes)</th>
</tr>
<tr>
<td class='confluenceTd'>CAN1</td>
<td class='confluenceTd'>0x160</td>
<td class='confluenceTd'>0x161</td>
<td class='confluenceTd'>10</td>
<td class='confluenceTd'>64</td>
</tr>
<tr>
<td class='confluenceTd'>CAN2</td>
<td class='confluenceTd'>0x1A0</td>
<td class='confluenceTd'>0x1A1</td>
<td class='confluenceTd'>20</td>
<td class='confluenceTd'>64</td>
</tr>
<tr>
<td class='confluenceTd'>CAN3</td>
<td class='confluenceTd'>0x1E0</td>
<td class='confluenceTd'>0x1E1</td>
<td class='confluenceTd'>20</td>
<td class='confluenceTd'>64</td>
</tr>
<tr>
<td class='confluenceTd'>CAN4</td>
<td class='confluenceTd'>0xB0</td>
<td class='confluenceTd'>0xB1</td>
<td class='confluenceTd'>50</td>
<td class='confluenceTd'>64</td>
</tr>
<tr>
<td class='confluenceTd'>CAN5</td>
<td class='confluenceTd'>0x2A5</td>
<td class='confluenceTd'>0x2A6</td>
<td class='confluenceTd'>50</td>
<td class='confluenceTd'>8</td>
</tr>
<tr>
<td class='confluenceTd'>CAN6</td>
<td class='confluenceTd'>0x74</td>
<td class='confluenceTd'>0x75</td>
<td class='confluenceTd'>100</td>
<td class='confluenceTd'>8</td>
</tr>
<tr>
<td class='confluenceTd'>CAN7</td>
<td class='confluenceTd'>0x8D</td>
<td class='confluenceTd'>0x8E</td>
<td class='confluenceTd'>100</td>
<td class='confluenceTd'>64</td>
</tr>
</tbody></table>
</div>

        </td></tr>
            </table>
Generated at Wed Aug 19 16:58:03 CST 2020 by Allen Shen using JIRA 7.6.1#76002-sha1:21e6670fec8f938624930061160092a4f331760a.

</body>
</html>